@model FitSammenWebClient.ViewModel.ClassListViewModel

@{
    var memberNumber = 3;
}

@{
    ViewData["Title"] = "Home Page";
}

@{
    // TODO: Erstat med rigtig login-check når login er implementeret fra controlleren
    bool isLoggedIn = false;
}

@{
    var signUpMessage = TempData["SignUpMessage"] as string;
    var signUpStatus = TempData["SignUpStatus"] as string;

    var waitingMessage = TempData["WaitingListMessage"] as string;
    var waitingStatus = TempData["WaitingListStatus"] as string;

    string headerClass = "";
    string titleText = "Besked";
    bool isWaitingList = false;

    // Til at håndtere både almindelig tilmelding og venteliste-tilmelding
    if (string.IsNullOrEmpty(signUpMessage) && !string.IsNullOrEmpty(waitingMessage))
    {
        signUpMessage = waitingMessage;
        signUpStatus = waitingStatus;
        isWaitingList = true;
    }

    if (!string.IsNullOrEmpty(signUpMessage))
    {
        headerClass = signUpStatus == "success" ? "bg-success text-white" : "bg-danger text-white";

        if (isWaitingList)
        {
            titleText = signUpStatus == "success"  ? "Venteliste tilmelding gennemført" : "Venteliste tilmelding mislykkedes";
        }
        else
        {
            titleText = signUpStatus == "success"  ? "Tilmelding gennemført" : "Tilmelding mislykkedes";
        }
    }
}

<section class="Hero">
    <div class="Hero-inner">
        <div class="text-center">
            <h1 class="overskrift">Fitness sjovere sammen</h1>
            <p class="underoverskrift">Motivation er lettest sammen</p>
        </div>
        <form method="get" asp-action="Index">
            <div class="filterbar">
                <select name="centre" id="centre">
                    <option value="all">Alle centre</option>
                    <option value="Kastetvej">Kastetvej</option>
                    <option value="Ryesgade">Ryesgade</option>
                    <option value="Kongensgade">Kongensgade</option>
                </select>
                <select name="hold" id="hold">

                    <option value="">Aalborg</option>
                    <option value="">Aarhus</option>
                    <option value="">Odense</option>

                </select>
                <input type="date" />
                <input type="submit" value="Søg" class="btn btn-primary" />
            </div>
        </form>
    </div>
</section>
<section>
    <h1 class="vælg-hold-overskrift">Vælg Hold</h1>
    <div class="hold">
        <button type="button" onclick="ClickLeft()" class="hold-arrow Hold-arrow-left">&#10094;</button>

        <div class="hold-liste">
            @foreach (var item in Model.Classes)
            {
                <div class="hold-card">
                    <br /> <b>Holdtype: </b> @item.ClassType
                    <br /> <b>Hold: </b> @item.Name
                    <br /> <b>Kapacitet: </b>@item.Capacity pladser
                    <br /> <b>Kl: </b> @item.StartTime
                    <br /> <b>Lokation: </b>@item.Room.Location.StreetName
                    <b>, </b>@item.Room.Location.Zipcode.City.CityName
                    <br /> <b>Længde: </b>@item.DurationInMinutes minutter
                    <br /> <b>Pladser tilbage: </b>@item.RemainingSpots

                    @if (isLoggedIn)
                    {
                        if (item.RemainingSpots > 0)
                        {
                            <!-- almindelig tilmelding -->
                            <form method="post" asp-action="SignUpToClass">
                                <input name="userNumber" id="UserNumber" value="@memberNumber" hidden="hidden" />
                                <input name="ClassId" id="ClassId" value="@item.ClassId" hidden="hidden" />
                                <br />
                                <input type="submit" value="Tilmeld" class="btn btn-success" />
                            </form>
                        }
                        else
                        {
                            <!-- venteliste -->
                            <form method="post" asp-action="SignUpToWaitingList">
                                <input name="userNumber" id="UserNumber" value="@memberNumber" hidden="hidden" />
                                <input name="ClassId" id="ClassId" value="@item.ClassId" hidden="hidden" />
                                <br />
                                <input type="submit" value="Tilmeld venteliste" class="btn btn-primary" />
                            </form>
                        }
                    }
                    else
                    {
                        <!-- ikke logget ind: vis popup-knap i stedet -->
                        <br />
                        <button type="button"
                                class="btn btn-success"
                                data-bs-toggle="modal"
                                data-bs-target="#loginRequiredModal">
                            Tilmeld
                        </button>
                    }
                </div>
            }
        </div>
        <div class="modal fade" id="signUpModal" tabindex="-1" aria-labelledby="signUpModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header @headerClass">
                        <h5 class="modal-title" id="signUpModalLabel">@titleText</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Luk"></button>
                    </div>
                    <div class="modal-body">
                        @signUpMessage
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Luk</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="loginRequiredModal" tabindex="-1" aria-labelledby="loginRequiredLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-warning text-white">
                        <h5 class="modal-title" id="loginRequiredLabel">Login påkrævet</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Luk"></button>
                    </div>
                    <div class="modal-body">
                        Du skal være logget ind som medlem for at kunne tilmelde dig et hold.
                    </div>
                    <div class="modal-footer">
                        <a asp-controller="Account" asp-action="Login" class="btn btn-success">Log ind</a>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Luk</button>
                    </div>
                </div>
            </div>
        </div>

        <button type="button" onclick="ClickRight()" class="hold-arrow Hold-arrow-right">&#10095;</button>
    </div>
</section>

<script src="~/js/site.js" asp-append-version="true"></script>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var hasMessage = '@(string.IsNullOrEmpty(signUpMessage) ? "false" : "true")';

            if (hasMessage === "true") {
                var modalElement = document.getElementById('signUpModal');
                if (modalElement) {
                    var myModal = new bootstrap.Modal(modalElement);
                    myModal.show();
                }
            }
        });
    </script>
}
